<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>IoT Roślinki - Dashboard</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

 <!-- CSS -->
    <link href="static/css/main.css" rel="stylesheet" />
    <link href="static/css/bootstrap.min.css" rel="stylesheet" />
    <link href="static/css/animate.min.css" rel="stylesheet" />
    <link href="static/css/paper-dashboard.css" rel="stylesheet" />
  <!-- Fonts & icons -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP"
    crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
  <link href="static/css/themify-icons.css" rel="stylesheet">
    <!--jquery-->
    <script src="static/js/jquery.min.js" type="text/javascript"></script>

  <style>
    .device-dropdown {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 14px;
      color: #444;
      margin-left: 10px;
    }

    .device-dropdown:focus {
      outline: none;
      border-color: #8b7d6b;
      box-shadow: 0 0 3px rgba(139, 125, 107, 0.3);
    }
  </style>
</head>

<body>
  <div class="wrapper">

    <!-- Sidebar -->
    <div class="sidebar" data-background-color="white" data-active-color="warning">
      <div class="sidebar-wrapper">
        <div class="logo">
        <a href="/devices" class="simple-text" style="display:flex; align-items:center; justify-content:center; gap:8px;">
             <i class="fas fa-seedling" style="color:#2eff00; font-size:20px;"></i>
                 IoT&nbsp;Roślinki
            </a>
        </div>

        <ul class="nav">
          <li >
            <a href="/devices">
              <i class="fas fa-leaf"></i>
              <p>Devices</p>
            </a>
          </li>
          <li class="active">
            <a href="/dashboard">
              <i class="fas fa-tachometer-alt"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li>
            <a href="/graph">
              <i class="ti-pie-chart"></i>
              <p>Graphs</p>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Panel -->
    <div class="main-panel">
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar bar1"></span>
              <span class="icon-bar bar2"></span>
              <span class="icon-bar bar3"></span>
            </button>

            <a class="navbar-brand" href="#">Dashboard</a>
            <div class="navbar-brand dashboard-title">
              <select id="deviceSelect" class="device-dropdown"></select>
            </div>
          </div>
        </div>
      </nav>

      <!-- Content -->
      <div class="content">
        <div class="container-fluid">

          <!-- Sensor Cards -->
          <div class="row">
            <div class="col-lg-4 col-sm-6">
              <div class="card">
                <div class="content">
                  <div class="row">
                    <div class="col-xs-4">
                      <div class="icon-big icon-danger text-center">
                        <i class="fas fa-temperature-high"></i>
                      </div>
                    </div>
                    <div class="col-xs-8">
                      <div class="numbers">
                        <p>Temperature</p>
                        <span id="tempValue"></span>&#176;C
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-sm-6">
              <div class="card">
                <div class="content">
                  <div class="row">
                    <div class="col-xs-3">
                      <div class="icon-big icon-info text-center">
                        <i class="fas fa-tint"></i>
                      </div>
                    </div>
                    <div class="col-xs-9">
                      <div class="numbers">
                        <p>Humidity</p>
                        <span id="humValue"></span>%
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-sm-6">
              <div class="card">
                <div class="content">
                  <div class="row">
                    <div class="col-xs-3">
                      <div class="icon-big icon-success text-center">
                        <i class="fas fa-seedling"></i>
                      </div>
                    </div>
                    <div class="col-xs-9">
                      <div class="numbers">
                        <p>Soil Moisture</p>
                        <span id="soilValue">%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Brightness Level -->
          <div class="row">
            <div class="col-lg-4 col-sm-6">
              <div class="card">
                <div class="content">
                  <div class="row">
                    <div class="col-xs-3">
                      <div class="icon-big icon-warning text-center">
                        <i class="fas fa-lightbulb"></i>
                      </div>
                    </div>
                    <div class="col-xs-9">
                      <div class="numbers">
                        <p>Brightness Level</p>
                        <span id="lightValue"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Automated Watering & Lighting -->
          <div class="row">
            <!-- Watering -->
            <div class="col-md-4">
              <div class="card">
                <div class="header">
                  <h4 class="title">Automated Watering</h4>
                </div>
                <div class="content text-center">
                  <label class="toggleBtn">
                    <input class="switch-input" id="autoSwitch" type="checkbox" onclick="auto()" />
                    <span class="switch-label" data-on="on" data-off="off"></span>
                    <span class="switch-handle"></span>
                  </label>

                  <div class="form-group mt-3">
                    <label for="wateringThreshold">Threshold:</label>
                    <input type="number" id="wateringThreshold" class="form-control text-center"
                           placeholder="Enter threshold" min="0" max="100"
                           onchange="saveThreshold('watering', this.value)" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Lighting -->
            <div class="col-md-4">
              <div class="card">
                <div class="header">
                  <h4 class="title">Automated Lighting</h4>
                </div>
                <div class="content text-center">
                  <label class="toggleBtn">
                    <input class="switch-input" id="manualSwitch" type="checkbox" onclick="manual()" />
                    <span class="switch-label" data-on="on" data-off="off"></span>
                    <span class="switch-handle"></span>
                  </label>

                  <div class="form-group mt-3">
                    <label for="lightingThreshold">Threshold:</label>
                    <input type="number" id="lightingThreshold" class="form-control text-center"
                           placeholder="Enter threshold" min="0" max="100"
                           onchange="saveThreshold('lighting', this.value)" />
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Device dropdown
    document.addEventListener("DOMContentLoaded", () => {
      const select = document.getElementById("deviceSelect");
      if (!select) return;

      const devices = JSON.parse(localStorage.getItem("devices") || "[]");
      const selected = localStorage.getItem("selectedDevice");

      if (devices.length === 0) {
        const opt = document.createElement("option");
        opt.textContent = "No devices";
        opt.disabled = true;
        select.appendChild(opt);
        return;
      }

      devices.forEach((d) => {
        const opt = document.createElement("option");
        opt.value = d.ip;
        opt.textContent = d.name;
        if (selected === d.ip) opt.selected = true;
        select.appendChild(opt);
      });

      select.addEventListener("change", () => {
        localStorage.setItem("selectedDevice", select.value);
        window.location.reload();
      });
    });

    // Save thresholds
    function saveThreshold(type, value) {
      localStorage.setItem(`${type}Threshold`, value);
      console.log(`Saved ${type} threshold:`, value);
    }

    window.onload = function() {
      const wateringValue = localStorage.getItem('wateringThreshold');
      const lightingValue = localStorage.getItem('lightingThreshold');
      if (wateringValue) document.getElementById('wateringThreshold').value = wateringValue;
      if (lightingValue) document.getElementById('lightingThreshold').value = lightingValue;
    };

    // Dummy switch functions
    function auto() { console.log("Auto watering toggled"); }
    function manual() { console.log("Manual lighting toggled"); }
  </script>

  <script src="static/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="static/js/bootstrap-checkbox-radio.js"></script>
  <script src="static/js/chartist.min.js"></script>
  <script src="static/js/paper-dashboard.js"></script>
  <script src="static/js/main.js" type="text/javascript"></script>

</body>
</html>
